var TorchLight=function(){function k(a,b,e){b=a.parentNode;this.scene=new THREE.Scene;this.camera=new THREE.PerspectiveCamera(60,a.width/a.height,.01,15E3);this.camera.position.z=200;this.renderer=new THREE.WebGLRenderer({alpha:!0});a=a.height*l.innerWidth()/a.width;this.renderer.setSize(l.innerWidth(),a);this.renderer.setClearColor(0,0);b.appendChild(this.renderer.domElement);this.uniforms={};this.mesh=null}function n(a,b){this.functions=a?a:[];this.clock=new THREE.Clock(!0);this.cv=b}function c(){this.targetImg=
null;this.forever=!1;this.toTime=this.fromTime=0;this.animFrame=this.glCanvas=null}var m=null,l=null,h={},p=!1;k.prototype.drawImage=function(a){var b=new THREE.PlaneBufferGeometry(a.width,a.height,1,1),e=new THREE.Texture(a);e.needsUpdate=!0;e.minFilter=THREE.NearestFilter;var d=new THREE.AmbientLight(16777215);this.scene.add(d);this.uniforms={time:{type:"f",value:1},resolution:{type:"v2",value:new THREE.Vector2},texture:{type:"t",value:e},posX:{type:"f",value:.4},posY:{type:"f",value:.5},radius:{type:"f",
value:.25},aspectRatioSq:{type:"f",value:a.width*a.width/(a.height*a.height)}};a=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:document.getElementById("vs0").textContent,fragmentShader:document.getElementById("fs1").textContent});this.mesh=new THREE.Mesh(b,a);this.mesh.position.x=0;this.mesh.position.y=0;this.mesh.position.z=-10;this.scene.add(this.mesh);this.renderer.render(this.scene,this.camera)};k.prototype.render=function(){this.renderer.render(this.scene,this.camera)};n.prototype.start=
function(){var a=this;requestAnimationFrame(function(){a.start.call(a)});for(var b=0;b<this.functions.length;++b)this.functions[b].call(null,this.cv,this.clock.getElapsedTime(),this.clock.getDelta());this.clock.running||this.clock.start()};c.prototype.setTarget=function(a){this.targetImg=a;this.glCanvas=new k(a);this.glCanvas.drawImage(a)};c.prototype.setForever=function(){this.forever=!0};c.prototype.show=function(){$(this.glCanvas.renderer.domElement).show()};c.prototype.hide=function(){$(this.glCanvas.renderer.domElement).hide()};
c.prototype.start=function(){var a=0,b=.005,e=.005;(new n([function(d,g,f){a+=1E3*f;if(5E-7<=a){g=d.uniforms.posX.value;f=d.uniforms.posY.value;g+=b;f+=e;var c=Math.random()/5;g>=.85+c?b=-.005-Math.random()/100:g<=.05-c&&(b=.005+Math.random()/100);f>=.85+c?e=-.005-Math.random()/100:f<=.05-c&&(e=.005+Math.random()/100);d.uniforms.posX.value=g;d.uniforms.posY.value=f;a=0}},function(a,b,c){a.render()}],this.glCanvas)).start()};return{effect:c,apply:function(a,b,c){m=c;l=$(m);var d=m.appendChild(document.createElement("img"));
d.addEventListener("load",function(){h.start=function(){a.setTarget(d);a.setForever();a.start();p=!0};h.isStarted=function(){return p};h.show=function(){a.show()};h.hide=function(){a.hide()}});d.width=375;d.setAttribute("id","torchImg");d.src=b},mkawesome:h}}();