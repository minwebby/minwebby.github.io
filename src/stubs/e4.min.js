var MonkeyScroll=function(){function g(a,c,b){this.scene=new THREE.Scene;this.camera=new THREE.PerspectiveCamera(30,c/b,1E-5,1E4);this.camera.position.z=2;this.camera.rotation.x=.1;this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});this.renderer.setSize(c,b);a.appendChild(this.renderer.domElement);this.uniforms={};this.mainObj=null;this.doRotate=!0}function h(a,c){this.functions=a?a:[];this.clock=new THREE.Clock(!0);this.cv=c}function f(a){this.targetImg=null;this.forever=!1;this.toTime=
this.fromTime=0;this.animFrame=this.glCanvas=null;this.container=document.getElementById(a);this.container.style.position="fixed";this.container.style.top="50%";this.container.style.left=window.innerWidth-110+"px";this.animTask=null;this.animTime=this.newScrollPos=0;this.visibilityPoint=$("#play").position().top;$(this.container).addClass("page-scroll").css("cursor","pointer");$(this.container).click(function(){window.scrollTo(0,0)})}g.prototype.loadMesh=function(a,c){var b=this;(new THREE.JSONLoader).load(a,
function(a,e){b.uniforms={time:{type:"f",value:1},scroll:{type:"f",value:0},color:{type:"c",value:new THREE.Color(10044450)},size:{type:"f",value:5},scale:{type:"f",value:1},opacity:{type:"f",value:1},cameraVec:{type:"3fv",value:b.camera.position}};var d=new THREE.ShaderMaterial({uniforms:b.uniforms,vertexShader:document.getElementById("vs1").textContent,fragmentShader:document.getElementById("fs2").textContent});a.computeFaceNormals();a.computeVertexNormals(!0);a.normalsNeedUpdate=!0;d=new THREE.Mesh(a,
d);b.scene.add(d);d.position.x=0;d.position.y=0;d.position.z=0;d.scale.set(.5,.5,.5);b.mainObj=d;b.renderer.render(b.scene,b.camera);setTimeout(c,0)});var e=new THREE.AmbientLight(16777215);this.scene.add(e)};g.prototype.render=function(){this.renderer.render(this.scene,this.camera)};h.prototype.start=function(){var a=this;requestAnimationFrame(function(){a.start.call(a)});for(var c=0;c<this.functions.length;++c)this.functions[c].call(null,this.cv,this.clock.getElapsedTime(),this.clock.getDelta());
this.clock.running||this.clock.start()};f.prototype.animCanvas=function(){var a=this,c=function(){a.animCanvas.call(a)},b=$(this.container).position().top+5,e=this.newScrollPos,f=function(a,b,c){var d=a*a;a*=d;return b+(c-b)*(6*a*d-15*d*d+10*a)};this.animTime+=.01;var g=b,d=!1;b+50<e?(g=f(this.animTime,b+50,e),d=!0):b-50>e&&(g=f(this.animTime,b-50,e),d=!0);d?(this.container.style.top=g+"px",this.animTask=setTimeout(c,0)):this.glCanvas.doRotate=!0};f.prototype.handleScroll=function(a){this.newScrollPos=
$(a).scrollTop()+80;this.glCanvas.uniforms.scroll.value=this.newScrollPos;this.newScrollPos<this.visibilityPoint?$(this.container).addClass("invisible"):$(this.container).removeClass("invisible")};f.prototype.setMesh=function(a,c){this.glCanvas=new g(this.container,100,60);this.glCanvas.loadMesh(a,c);var b=this;$(this.container).addClass("invisible");$(window).scroll(function(a){b.handleScroll.call(b,a.currentTarget)})};f.prototype.setForever=function(){this.forever=!0};f.prototype.start=function(){var a=
0;this.glCanvas.render();$(this.glCanvas).addClass("invisible");(new h([function(c,b,e){a+=1E3*e;5E-6<=a&&(c.uniforms.time.value=b,c.mainObj.rotation.y=c.doRotate?c.mainObj.rotation.y+.2*Math.sin(b):.3)},function(a,b,e){a.render()}],this.glCanvas)).start()};return{effect:f,apply:function(a,c){a.setMesh(c,function(){a.start()})}}}();