var CarBox=function(){function h(a,b,c){this.scene=new THREE.Scene;this.camera=new THREE.PerspectiveCamera(45,b/c,1,1E3);this.camera.position.set(365,50,365);this.camera.lookAt(new THREE.Vector3(0,-150,-50));this.renderer=new THREE.WebGLRenderer({antialias:!0,transparent:!0});this.renderer.shadowMapEnabled=!0;this.renderer.shadowMapType=THREE.PCFSoftShadowMap;this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(b,c);g.appendChild(this.renderer.domElement);this.mirrorSphereCamera=
new THREE.CubeCamera(.1,5E3,512);this.mirrorSphereCamera.position.set(200,200,200);this.scene.add(this.mirrorSphereCamera);this.scene.add(new THREE.AmbientLight(13421772));a=new THREE.DirectionalLight(16777215,1);new THREE.Vector3(1,20,1);this.scene.add(a);a=new THREE.CubeGeometry(2500,50,2E3);b=THREE.ImageUtils.loadTexture("/src/theme/img/crate9.jpg");b=new THREE.MeshPhongMaterial({map:b});a=new THREE.Mesh(a,b);a.position.x=0;a.position.y=-180;a.position.z=0;a.receiveShadow=!0;a.castShadow=!1;this.scene.add(a);
a=new THREE.DirectionalLight(16777215,400);a.position.x=0;a.position.y=50;a.position.z=0;a.shadowCameraNear=.1;a.castShadow=!0;a.onlyShadow=!0;a.shadowDarkness=.5;a.angle=Math.PI/2;this.scene.add(a);a=[];a.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("/src/theme/img/posx.jpg")}));a.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("/src/theme/img/posx.jpg")}));a.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("/src/theme/img/posy.jpg")}));
a.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("/src/theme/img/negy.jpg")}));a.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("/src/theme/img/posx.jpg")}));a.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("/src/theme/img/negz.jpg")}));for(b=0;6>b;b++)a[b].side=THREE.BackSide;a=new THREE.MeshFaceMaterial(a);b=new THREE.CubeGeometry(5E3,5E3,5E3,1,1,1);a=new THREE.Mesh(b,a);this.scene.add(a)}function l(a,b){this.functions=a?a:[];this.clock=
new THREE.Clock(!0);this.cv=b}function e(){this.glCanvas=null;this.stopped=!1}var g=null,k=null,f={},m=!1;h.prototype.render=function(){this.mirrorSphereCamera.updateCubeMap(this.renderer,this.scene);this.renderer.render(this.scene,this.camera)};h.prototype.loadMesh=function(a){var b,c,d=this;(new THREE.SceneLoader).load(a,function(a){car=a.scene.children[1];c=car.children[0].children[0].children;for(b=0;b<c.length;b++)a=c[b],"body"===a.name&&(carBody=a,carBody.material.envMap=d.mirrorSphereCamera.renderTarget,
carBody.reflectivity=.2,carBody.material.combine=THREE.MixOperation),a instanceof THREE.Mesh&&(a.castShadow=!0);car.position.x=0;car.position.y=-150;car.position.z=-20;car.receiveShadow=!1;d.scene.add(car);d.renderer.render(d.scene,d.camera)},function(a){})};l.prototype.start=function(){var a=this;requestAnimationFrame(function(){a.start.call(a)});for(var b=0;b<this.functions.length;++b)this.functions[b].call(null,this.cv,this.clock.getElapsedTime(),this.clock.getDelta());this.clock.running||this.clock.start()};
e.prototype.setTarget=function(a,b,c,d){this.glCanvas=new h(b,c,d);this.glCanvas.loadMesh(a)};e.prototype.start=function(){var a=0,b=this;(new l([function(c,d,e){if(!b.stopped){d/=2;e=Math.sin(d);var f=Math.cos(d),g=300+150*e+150*f+a;a+=5*e*f;c.camera.position.x=g*Math.cos(d);c.camera.position.z=g*Math.sin(d);c.camera.lookAt(new THREE.Vector3(0,-150,-50))}},function(a,b,e){a.render()}],this.glCanvas)).start()};e.prototype.show=function(){this.stopped=!1};e.prototype.hide=function(){this.stopped=!0};
return{effect:e,apply:function(a,b,c){g=c;k=$(g);k.width();k.height();a.setTarget(b,g,800,500);f.start=function(){a.start();m=!0};f.hide=function(){a.hide()};f.show=function(){a.show()};f.isStarted=function(){return m}},mkawesome:f}}();